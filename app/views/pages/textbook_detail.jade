extends ../layout
block link
  link(href="/css/detail.css",rel="stylesheet")
block content
  .container
    .row
      .col-md-5
        .dl-horizontal
          dt Title
          dd= textbook.title
          dt Author
          dd= textbook.author
          dt Edition
          dd= textbook.edition
          dt Language
          dd= textbook.language
          dt Location
          dd= textbook.location
          dt Summary
          dd= textbook.summary
          dt Textbook Photo
          dd
            img(src="/upload_textbook/#{textbook.photo}", style="width:250px;height:250px;")
        .panel.panel-defatul
          .panel-heading
            h3 COMMENTS
          .panel-body
            ul.media-list#mediaList
              each item in comments
                li.media
                  .pull-left
                    img.media-object(src="/upload/#{item.from.image}", style="width: 40px; height: 40px;")
                  .media-body
                    h4.media-heading #{item.from.name}   
                    p #{item.content}
                    span.createAt #{moment(item.meta.createAt).format('MM-DD HH:mm')} &nbsp;&nbsp;&nbsp;&nbsp;                  
                    a.comment(href="#comments", data-cid="#{item._id}", data-tid="#{item.from._id}") REPLY
                    if user && item.from.name === user.name
                      a.commentDel(href="javascript:;", data-cid="#{item._id}") &nbsp;|&nbsp;DELETE
                    
                    if item.reply && item.reply.length > 0
                      each reply in item.reply
                        .media
                          .pull-left
                            img.media-object(src="/upload/#{reply.from.image}", style="width: 30px; height: 30px;")
                          .media-body
                            h4.media-heading
                              | #{reply.from.name}
                              span &nbsp;REPLY&nbsp;
                              | #{reply.to.name}
                            p #{reply.content}
                            span.createAt #{moment(reply.meta.createAt).format('MM-DD HH:mm')} &nbsp;&nbsp;&nbsp;&nbsp;
                            a.comment(href="#comments", data-cid="#{item._id}", data-tid="#{item.from._id}") REPLY
                            if user && reply.from.name === user.name
                              a.commentDel(href="javascript:;", data-cid="#{item._id}" data-did="#{reply._id}") &nbsp;|&nbsp;DELETE
                  hr
            #comments  
              form#commentForm(method="POST", action="/admin/comment")
                input(type="hidden", name="comment[textbook]", value="#{textbook._id}")
                if user
                  input(type="hidden", name="comment[from]", value="#{user._id}")
                .form-group
                  textarea.form-control(name="comment[content]", row="3")
                if user
                  button.btn.btn-primary(type='submit') SUBMIT
                else
                  a.navbar-link(href="#", data-toggle="modal", data-target="#signinModal") Please Log In To Comment
  script(src="/js/comment.js")
