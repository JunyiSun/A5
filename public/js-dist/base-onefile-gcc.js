$(function(){function b(a){return 10>a?"0"+a:""+a}function c(a){return b(a.getMonth()+1)+"-"+b(a.getDate())+" "+b(a.getHours())+":"+b(a.getMinutes())}$("#mediaList").on("click",".chat",function(a){a=$(this);var d=a.data("tid"),b=a.data("cid");$(a).parents(".media-body").attr("id","mediaBody");0<$("#toId").length?$("#toId").val(d):$("<input>").attr({type:"hidden",id:"toId",name:"chat[tid]",value:d}).appendTo("#chatForm");0<$("#chatId").length?$("#chatId").val(b):$("<input>").attr({type:"hidden",id:"chatId",
name:"chat[cid]",value:b}).appendTo("#chatForm")});$("#chats button").on("click",function(a){a.preventDefault();$.ajax({url:"/admin/chat",type:"POST",data:{"chat[with]":$("#chats input:eq(0)").val(),"chat[from]":$("#chats input:eq(1)").val(),"chat[content]":$("#chats textarea").val(),"chat[tid]":$("#toId").val(),"chat[cid]":$("#chatId").val()}}).done(function(d){d=d.data||{};if(d.reply.length){var a=d.reply.length;$("#mediaBody").append('<div class="media"><div class="pull-left"><img src="/upload_user/'+
d.reply[a-1].from.image+'" style="width: 30px; height: 30px;" /></div><div class="media-body"><h4 class="media-heading">'+d.reply[a-1].from.name+"<span>&nbsp;REPLY&nbsp;</span>"+d.reply[a-1].to.name+"</h4><p>"+d.reply[a-1].content+'</p><span class="createAt">'+c(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="chat" href="#chats" data-cid='+d._id+" data-tid="+d.from._id+"> REPLY</a></div></div>")}else $("#mediaList").append('<li class="media"><div class="pull-left"><img src="/upload_user/'+d.from.image+
'" style="width: 40px; height: 40px;" /></div><div class="media-body"><h4 class="media-heading">'+d.from.name+"</h4><p>"+d.content+'</p><span class="createAt">'+c(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="chat" href="#chats" data-cid='+d._id+" data-tid="+d.from._id+"> REPLY</a></div><hr></li>");$("#chats textarea").val("");$("#mediaBody").removeAttr("id");$("#chatForm input:gt(1)").remove()})})});$(function(){function b(a){return 10>a?"0"+a:""+a}function c(a){return b(a.getMonth()+1)+"-"+b(a.getDate())+" "+b(a.getHours())+":"+b(a.getMinutes())}$("#mediaList").on("click",".comment",function(a){a=$(this);var d=a.data("tid"),b=a.data("cid");$(a).parents(".media-body").attr("id","mediaBody");0<$("#toId").length?$("#toId").val(d):$("<input>").attr({type:"hidden",id:"toId",name:"comment[tid]",value:d}).appendTo("#commentForm");0<$("#commentId").length?$("#commentId").val(b):$("<input>").attr({type:"hidden",
id:"commentId",name:"comment[cid]",value:b}).appendTo("#commentForm")});$("#comments button").on("click",function(a){a.preventDefault();$.ajax({url:"/admin/comment",type:"POST",data:{"comment[textbook]":$("#comments input:eq(0)").val(),"comment[from]":$("#comments input:eq(1)").val(),"comment[content]":$("#comments textarea").val(),"comment[tid]":$("#toId").val(),"comment[cid]":$("#commentId").val()}}).done(function(a){a=a.data||{};if(a.reply.length){var b=a.reply.length;$("#mediaBody").append('<div class="media"><div class="pull-left"><img src="/upload_user/'+
a.reply[b-1].from.image+'" style="width: 30px; height: 30px;" /></div><div class="media-body"><h4 class="media-heading">'+a.reply[b-1].from.name+"<span>&nbsp;REPLY&nbsp;</span>"+a.reply[b-1].to.name+"</h4><p>"+a.reply[b-1].content+'</p><span class="createAt">'+c(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+a._id+" data-tid="+a.from._id+'>REPLY</a>&nbsp;|&nbsp;<a class="commentDel" href="javascript:;" data-cid='+a._id+" data-did="+a.reply[b-1]._id+">DELETE</a></div></div>")}else $("#mediaList").append('<li class="media"><div class="pull-left"><img src="/upload_user/'+
a.from.image+'" style="width: 40px; height: 40px;" /></div><div class="media-body"><h4 class="media-heading">'+a.from.name+"</h4><p>"+a.content+'</p><span class="createAt">'+c(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+a._id+" data-tid="+a.from._id+'>REPLY</a>&nbsp;|&nbsp;<a class="commentDel" href="javascript:;" data-cid='+a._id+">DELETE</a></div><hr></li>");$("#comments textarea").val("");$("#mediaBody").removeAttr("id");$("#commentForm input:gt(1)").remove()})});
$("#mediaList").on("click",".commentDel",function(a){var b=$(this).parent(".media-body"),c=$(a.target).data("cid");a=$(a.target).data("did");$.ajax({url:"/textbook/:id?cid="+c+"&did="+a,type:"DELETE"}).done(function(a){1===a.success&&b.parent().remove()})})});$(function(){function b(b,a,d,f){$.ajax({url:a,type:d,data:{"user[email]":$(b).find("input:eq(0)").val(),"user[password]":$(b).find("input:eq(1)").val(),"user[newpassword]":$(b).find("input:eq(2)").val(),"user[confirmnewpassword]":$(b).find("input:eq(3)").val()}}).done(f)}$("#dChangeForm").validate({rules:{"user[password]":{required:!0},"user[newpassword]":{required:!0,minlength:2,maxlength:20},"user[confirmnewpassword]":{equalTo:"#dChangenewPassword"}},messages:{"user[password]":{required:"Old password is required"},
"user[newpassword]":{required:"New password is required",minlength:"Min password length is 2",maxlength:"Max password length is 20"},"user[confirmnewpassword]":{equalTo:"Passwords do not match"}}});$("#dChangeForm").submit(function(c){c.preventDefault();b(this,"/user/changepassword","POST",function(a){switch(a.data){case 0:$("#dChangeForm .err_tip1").html("Account Does Not Exist").attr("style","block");break;case 1:$("#dChangeForm .err_tip1").html("Password Does Not Match Email").attr("style","block");
break;case 2:$("#dChangeForm .err_tip1").html("Passwords do not match").attr("style","block");break;default:$("a")[0].click()}})})});$(function(){$(".increaseRating").click(function(b){b=$(b.target).data("id");var c=$(".rate");console.log("nice");$.ajax({type:"PUT",url:"/rating?id="+b}).done(function(a){1===a.success&&c&&c.remove()})});$(".decreaseRating").click(function(b){b=$(b.target).data("id");var c=$(".rate");$.ajax({type:"PUT",url:"/ratingdown?id="+b}).done(function(a){1===a.success&&c&&c.remove()})})});$(function(){$(".userDel").click(function(b){var c=$(b.target).data("id"),a=$(".item-id-"+c);$.ajax({type:"DELETE",url:"/admin/user/list?id="+c}).done(function(b){1===b.success&&a&&a.remove()});b.stopPropagation()});$(".clickable-row").click(function(){window.location=$(this).data("href")});$(".subjectDel").click(function(b){b=$(b.target).data("id");var c=$(".item-id-"+b);$.ajax({type:"DELETE",url:"/admin/subject/list?id="+b}).done(function(a){1===a.success&&c&&c.remove()})});$(".textbookDel").click(function(b){b=
$(b.target).data("id");var c=$(".item-id-"+b);$.ajax({type:"DELETE",url:"/admin/textbook/list?id="+b}).done(function(a){1===a.success&&c&&c.remove()})});$(".traderequestDel").click(function(b){b=$(b.target).data("id");var c=$(".item-id-"+b);$.ajax({type:"DELETE",url:"/traderequest/list/reject?id="+b}).done(function(a){1===a.success&&c&&c.remove()})});$(".traderequestCompl").click(function(b){b=$(b.target).data("id");var c=$(".item-id-"+b);$.ajax({type:"DELETE",url:"/traderequest/list/complete?id="+
b}).done(function(a){1===a.success&&c&&c.remove()})})});$(function(){function b(a,b,c){$(a).validate({rules:{"user[email]":{required:!0,email:!0},"user[password]":{required:!0,minlength:b,maxlength:c},"user[confirmpassword]":{equalTo:"#signupPassword"}},messages:{"user[email]":{required:"Email is required",email:"Invalid Email"},"user[password]":{required:"Password is required",minlength:"Min password length is "+b,maxlength:"Max password length is "+c},"user[confirmpassword]":{equalTo:"Passwords do not match"}}})}function c(a,b,c,e){$.ajax({url:b,type:c,
data:{"user[email]":$(a).find("input:eq(0)").val(),"user[password]":$(a).find("input:eq(1)").val(),"user[confirmpassword]":$(a).find("input:eq(2)").val()}}).done(e)}function a(a,b,c,e){$.ajax({url:b,type:c,data:{"user[email]":$(a).find("input:eq(0)").val(),"user[password]":$(a).find("input:eq(1)").val()}}).done(e)}b("#signinForm",2,20);$("#signinForm").submit(function(b){b.preventDefault();a(this,"/user/signin","POST",function(a){switch(a.data){case 0:$("#signinForm .err_tip").html("Account Does Not Exist").attr("style",
"block");break;case 1:$("#signinForm .err_tip").html("Password Does Not Match Email").attr("style","block");break;case 2:window.location="/regular/user/list";break;case 3:window.location="/admin/user/list";break;default:window.location="/regular/user/list"}})});b("#signupForm",2,20);$("#signupForm").submit(function(a){a.preventDefault();c(this,"/user/signup","POST",function(a){switch(a.data){case 0:$("#signupForm .err_tip").html("Account Already Exists").attr("style","block");break;case 1:window.location=
"/admin/user/list";break;case 2:window.location="/regular/user/list";break;case 3:$("#signupForm .err_tip").html("Passwords do not match").attr("style","block");break;default:window.location="/regular/user/list"}})});b("#dSigninForm",2,20);$("#dSigninForm").submit(function(a){a.preventDefault();c(this,"/user/signin","POST",function(a){switch(a.data){case 0:$("#dSigninForm .err_tip").html("Account Does Not Exist").attr("style","block");break;case 1:$("#dSigninForm .err_tip").html("Password Does Not Match Email").attr("style",
"block");break;case 2:window.location="/regular/user/list";break;case 3:window.location="/admin/user/list";break;default:window.location="/regular/user/list"}})});b("#dSignupForm",2,20);$("#dSignupForm").submit(function(b){b.preventDefault();a(this,"/user/signup","POST",function(a){switch(a.data){case 0:$("#signupForm .err_tip").html("Account Already Exists").attr("style","block");break;case 1:window.location="/admin/user/list";break;case 2:window.location="/regular/user/list";break;case 3:$("#signupForm .err_tip").html("Passwords do not match").attr("style",
"block");break;default:window.location="/regular/user/list"}})})});$(function(){$(".userAdmin").click(function(b){b=$(b.target).data("id");var c=$(".user-id-"+b);$.ajax({type:"PUT",url:"/admin/user/profile?id="+b}).done(function(a){1===a.success&&("Make Administrator"==c.text()?c.html("Revoke Administrator"):c.html("Make Administrator"))})})});$(function(){$("#NewTextbookForm").validate({rules:{"textbook[title]":{required:!0},"textbook[subject]":{require_from_group:[1,".subject_group"]},"textbook[subjectName]":{require_from_group:[1,".subject_group"]}},messages:{"textbook[title]":{required:"Require Textbook Title"},"textbook[subject]":{require_from_group:"Subject Required"},"textbook[subjectName]":{require_from_group:"Subject Required"}}})});
